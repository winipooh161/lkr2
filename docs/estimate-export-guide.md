# Руководство по экспорту смет

## Обновленная система экспорта смет

В системе управления ремонтом добавлены расширенные возможности экспорта смет с тремя версиями документов для разных участников проекта.

### Доступные версии экспорта

#### 1. Полная версия (все данные)
- **Excel**: Содержит все данные сметы, включая базовые цены, наценки, скидки и клиентские цены
- **PDF**: Полная версия в формате PDF для архивирования и печати
- **Использование**: Внутренняя работа партнера, анализ рентабельности

#### 2. Для заказчика (клиентские цены)
- **Excel**: Смета с клиентскими ценами, без отображения базовых цен и наценок
- **PDF**: Презентационная версия для заказчика
- **Использование**: Предоставление заказчику, согласование стоимости работ

#### 3. Для мастера (базовые цены)
- **Excel**: Смета с базовыми ценами без наценок, для расчета стоимости материалов и работ
- **PDF**: Техническая версия для исполнителей
- **Использование**: Передача подрядчикам, закупка материалов

### Где найти кнопки экспорта

#### На странице редактирования сметы
1. Откройте смету для редактирования
2. В правом верхнем углу найдите кнопку "Экспорт" (зеленая кнопка с иконкой загрузки)
3. Нажмите на кнопку для открытия выпадающего меню
4. Выберите нужную версию и формат

#### На странице просмотра сметы
1. Откройте смету для просмотра
2. В правом верхнем углу найдите кнопку "Экспорт"
3. Выберите нужную версию и формат

#### В списке смет
1. В таблице смет найдите колонку "Действия"
2. Нажмите на кнопку "Действия" для нужной сметы
3. В выпадающем меню найдите раздел "Экспорт сметы"
4. Выберите нужную версию и формат

### Особенности экспорта

#### Автоматические уведомления
- При клике на кнопку экспорта появится уведомление о начале загрузки
- Через несколько секунд появится уведомление о готовности файла
- Уведомления автоматически исчезают через несколько секунд

#### Массовый экспорт
- На странице списка смет доступна функция "Экспорт всех"
- Позволяет экспортировать все сметы на текущей странице одним кликом
- Файлы загружаются последовательно с интервалом в 1 секунду

#### Форматы файлов
- **Excel (.xlsx)**: Редактируемый формат для дальнейшей работы
- **PDF**: Готовый для печати и презентации формат

### Маршруты API

```
GET /partner/estimates/{id}/export               - Полная версия Excel
GET /partner/estimates/{id}/export-pdf           - Полная версия PDF
GET /partner/estimates/{id}/export-client        - Версия для заказчика Excel
GET /partner/estimates/{id}/export-pdf-client    - Версия для заказчика PDF
GET /partner/estimates/{id}/export-contractor    - Версия для мастера Excel
GET /partner/estimates/{id}/export-pdf-contractor - Версия для мастера PDF
```

### Техническая информация

#### Обработка ошибок
- При ошибке экспорта пользователь получит уведомление
- Ошибки логируются в системный журнал
- Автоматический fallback на базовые данные при отсутствии JSON

#### Производительность
- Экспорт выполняется асинхронно
- Большие сметы могут занимать до 30 секунд
- Использование streaming для больших файлов

#### Безопасность
- Проверка прав доступа к смете перед экспортом
- Авторизация через политики Laravel
- Защита от несанкционированного доступа

### Решение проблем

#### Пустой или некорректный экспорт
1. Убедитесь, что смета содержит данные
2. Проверьте JSON структуру сметы
3. Обратитесь к администратору при повторяющихся проблемах

#### Медленная загрузка
1. Проверьте размер сметы (количество строк)
2. Дождитесь завершения предыдущего экспорта
3. При необходимости разбейте смету на части

#### Проблемы с форматированием PDF
1. Проверьте корректность данных в смете
2. Убедитесь в наличии всех необходимых шрифтов
3. Попробуйте экспорт в Excel как альтернативу
